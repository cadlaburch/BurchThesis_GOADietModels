visreg(WP_PH_M, "RLONG", type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "RLONG",
ylab = "Pollock Prescence in Halibut Stom")
visreg(WP_PH_M, "RLAT", type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "RLAT",
ylab = "Pollock Prescence in Halibut Stom")
WP_PH_fit
#PRED: Pacific cod
WP_PC_M <- gam(Walleyepollock ~ Year + s(RLONG, RLAT) + s(GEAR_DEPTH)+ s(GEAR_TEMP, k = 4) + PRED_LEN,
data = PC,
family = binomial(link = logit),
method = "GCV.Cp")
summary(WP_PC_M)
WP_PC_fit <- dredge(WP_PC_M, beta = F, evaluate = T, rank = "AIC", trace = F)
visreg(WP_PC_M, "Year",type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "Year",
ylab = "Pollock Prescence in Cod Stom")
visreg(WP_PC_M, "GEAR_DEPTH",type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "Gear_Depth",
ylab = "Pollock Prescence in Cod Stom")
visreg(WP_PC_M, "GEAR_TEMP",type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "Gear_temp",
ylab = "Pollock Prescence in Cod Stom")
visreg(WP_PC_M, "PRED_LEN",type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "Pred_length",
ylab = "Pollock Prescence in Cod Stom")
visreg(WP_PC_M, "RLONG", type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "RLONG",
ylab = "Pollock Prescence in Cod Stom")
visreg(WP_PC_M, "RLAT", type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "RLAT",
ylab = "Pollock Prescence in Cod Stom")
WP_PC_fit
#PRED: Arrowtooth flounder
WP_AF_M <- gam(Walleyepollock ~ Year + s(RLONG, RLAT) + s(GEAR_DEPTH)+ s(GEAR_TEMP, k = 4) + PRED_LEN,
data = AF,
family = binomial(link = logit),
method = "GCV.Cp")
summary(WP_AF_M)
WP_AF_fit <- dredge(WP_AF_M, beta = F, evaluate = T, rank = "AIC", trace = F)
visreg(WP_AF_M, "Year",type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "Year",
ylab = "Pollock Prescence in AFlounder Stom")
visreg(WP_AF_M, "GEAR_DEPTH",type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "Gear_Depth",
ylab = "Pollock Prescence in AFlounder Stom")
visreg(WP_AF_M, "GEAR_TEMP",type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "Gear_temp",
ylab = "Pollock Prescence in AFlounder Stom")
visreg(WP_AF_M, "PRED_LEN",type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "Pred_length",
ylab = "Pollock Prescence in AFlounder Stom")
visreg(WP_AF_M, "RLONG", type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "RLONG",
ylab = "Pollock Prescence in AFlounder Stom")
visreg(WP_AF_M, "RLAT", type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "RLAT",
ylab = "Pollock Prescence in AFlounder Stom")
WP_AF_fit
visreg2d(SL_WP_M, "RLONG", "RLAT", plot.type = "rgl")
library(splines)
visreg2d(SL_WP_M, "RLONG", "RLAT", plot.type = "rgl")
install.packages("rgl")
library(rgl)
visreg2d(SL_WP_M, "RLONG", "RLAT", plot.type = "rgl")
#I think I need to do a bit of data manipulation to get my data to look more like cheryls which is in a wide format
#I believe that her data is formatted so each line is a predator and the prey items are listed as columns within the pred stomach
#I need to create a unique identifier for each predator
wide_data <- data %>%
mutate(uniqueID = paste(HAULJOIN, PRED_NODC, PRED_SPECN), sep = "", #create unique pred id
pres_absent = ifelse(PREY_TWT > 0, 1, 0)) %>%
distinct(uniqueID, Year, Month, Day, Haul_Join, RLAT, RLONG, GEAR_DEPTH, BOTTOM_DEPTH, START_HOUR,
SURFACE_TEMP, GEAR_TEMP, INPFC_AREA, START_DATE, PRED_LEN, Pred_common, Prey_Name, pres_absent, Haul_Join) %>% #This big chunk is to get rid of redundancies
pivot_wider(names_from = Prey_Name, values_from = pres_absent, values_fill = list(pres_absent = 0)) %>%
rename(Walleyepollock = 'Walleye pollock')
#change year to factor
wide_data$Year <- factor(wide_data$Year)
#create day of year (Julien)
wide_data <- wide_data %>%
mutate(date = paste(Month, Day, sep = "-"))
wide_data$date <- as.Date(wide_data$date, "%m-%d")
wide_data$julien <- format(wide_data$date, "%j")
#Set length bins
wide_data <- wide_data %>%
mutate(Len_bin = cut(PRED_LEN, breaks = c(0, 29, 39, 49, 59, 69, 1000)))
levels(data$Len_bin) = c("<30", "30-39", "40-49", "50-59", "60-69", ">70")
WP <- wide_data %>%
filter(Pred_common == "Walleye pollock") %>%
na.omit()
PH <- wide_data %>%
filter(Pred_common == "Pacific halibut") %>%
na.omit()
PC <- wide_data %>%
filter(Pred_common == "Pacific cod") %>%
na.omit()
AF <- wide_data %>%
filter(Pred_common == "Arrowtooth flounder") %>%
na.omit()
Euph_WP_M <- gam(Euphausiacea ~ Year + s(RLONG, RLAT) + s(GEAR_DEPTH)+ s(GEAR_TEMP, k = 4) + PRED_LEN + Haul_Join,
data = WP,
family = binomial(link = logit),
method = "GCV.Cp")
wide_data_haul <- data %>%
mutate(uniqueID = paste(HAULJOIN, PRED_NODC, PRED_SPECN), sep = "", #create unique pred id
pres_absent = ifelse(PREY_TWT > 0, 1, 0)) %>%
group_by(Pred_common, Haul_Join) %>%
mutate(preysum = sum(pres_absent),
haul_PA = ifelse(preysum > 0, 1, 0)) %>%
distinct(uniqueID, Year, Month, Day, Haul_Join, RLAT, RLONG, GEAR_DEPTH, BOTTOM_DEPTH, START_HOUR,
SURFACE_TEMP, GEAR_TEMP, INPFC_AREA, START_DATE, PRED_LEN, Pred_common, Prey_Name, haul_PA) %>% #This big chunk is to get rid of redundancies
pivot_wider(names_from = Prey_Name, values_from = haul_PA, values_fill = list(haul_PA = 0)) %>%
rename(Walleyepollock = 'Walleye pollock')
wide_data_haul <- data %>%
mutate(uniqueID = paste(HAULJOIN, PRED_NODC, PRED_SPECN), sep = "", #create unique pred id
pres_absent = ifelse(PREY_TWT > 0, 1, 0)) %>%
group_by(Pred_common, Haul_Join) %>%
mutate(preysum = sum(pres_absent),
haul_PA = ifelse(preysum > 0, 1, 0)) %>%
distinct(Year, Month, Day, Haul_Join, RLAT, RLONG, GEAR_DEPTH, BOTTOM_DEPTH, START_HOUR,
SURFACE_TEMP, GEAR_TEMP, INPFC_AREA, START_DATE, PRED_LEN, Pred_common, Prey_Name, haul_PA) %>% #This big chunk is to get rid of redundancies
pivot_wider(names_from = Prey_Name, values_from = haul_PA, values_fill = list(haul_PA = 0)) %>%
rename(Walleyepollock = 'Walleye pollock')
View(wide_data_haul)
wide_data <- data %>%
mutate(uniqueID = paste(HAULJOIN, PRED_NODC, PRED_SPECN), sep = "", #create unique pred id
pres_absent = ifelse(PREY_TWT > 0, 1, 0)) %>%
group_by(Pred_common, Haul_Join) %>%
mutate(preysum = sum(pres_absent),
haul_PA = ifelse(preysum > 0, 1, 0)) %>%
distinct(Year, Month, Day, Haul_Join, RLAT, RLONG, GEAR_DEPTH, BOTTOM_DEPTH, START_HOUR,
SURFACE_TEMP, GEAR_TEMP, INPFC_AREA, START_DATE, PRED_LEN, Pred_common, Prey_Name, haul_PA) %>% #This big chunk is to get rid of redundancies
pivot_wider(names_from = Prey_Name, values_from = haul_PA, values_fill = list(haul_PA = 0)) %>%
rename(Walleyepollock = 'Walleye pollock')
#I think it needs to be grouped by haul
haul_wide <- wide_data %>%
group_by(Haul_Join, Pred_common)
#check that the each stomach is it's own unique line
length(unique(wide_data$uniqueID))
#change year to factor
wide_data$Year <- factor(wide_data$Year)
#create day of year (Julien)
wide_data <- wide_data %>%
mutate(date = paste(Month, Day, sep = "-"))
wide_data$date <- as.Date(wide_data$date, "%m-%d")
wide_data$julien <- format(wide_data$date, "%j")
#Set length bins
wide_data <- wide_data %>%
mutate(Len_bin = cut(PRED_LEN, breaks = c(0, 29, 39, 49, 59, 69, 1000)))
levels(data$Len_bin) = c("<30", "30-39", "40-49", "50-59", "60-69", ">70")
WP <- wide_data %>%
filter(Pred_common == "Walleye pollock") %>%
na.omit()
PH <- wide_data %>%
filter(Pred_common == "Pacific halibut") %>%
na.omit()
PC <- wide_data %>%
filter(Pred_common == "Pacific cod") %>%
na.omit()
AF <- wide_data %>%
filter(Pred_common == "Arrowtooth flounder") %>%
na.omit()
Euph_WP_M <- gam(Euphausiacea ~ Year + s(RLONG, RLAT) + s(GEAR_DEPTH)+ s(GEAR_TEMP, k = 4) + PRED_LEN + Haul_Join,
data = WP,
family = binomial(link = logit),
method = "GCV.Cp")
Euph_WP_M <- gam(Euphausiacea ~ Year + s(RLONG, RLAT) + s(GEAR_DEPTH)+ s(GEAR_TEMP, k = 4) + PRED_LEN,
data = WP,
family = binomial(link = logit),
method = "GCV.Cp")
summary(Euph_WP_M)
Euph_WP_fit <- dredge(Euph_WP_M, beta = F, evaluate = T, rank = "AIC", trace = F)
Euph_WP_fit
visreg(Euph_WP_M, "Year",type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "Year",
ylab = "Euphausiacea Prescence in Pollock Stom")
visreg(Euph_WP_M, "GEAR_DEPTH",type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "Gear_Depth",
ylab = "Euphausiacea Prescence in Pollock Stom")
visreg(Euph_WP_M, "GEAR_TEMP",type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "Gear_temp",
ylab = "Euphausiacea Prescence in Pollock Stom")
visreg(Euph_WP_M, "Len_bin",type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "Pred_length",
ylab = "Euphausiacea Prescence in Pollock Stom")
visreg(Euph_WP_M, "RLONG", type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "RLONG",
ylab = "Euphausiacea Prescence in Pollock Stom")
visreg(Euph_WP_M, "RLAT", type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "RLAT",
ylab = "Euphausiacea Prescence in Pollock Stom")
unique(data$HAULJOIN)
length(unique(data$HAULJOIN))
length(unique(data$Haul_Join))
#remove empty stomachs
data <- data %>%
filter(Prey_Name != "Empty") %>%
mutate(uniqueID = paste(HAULJOIN, PRED_NODC, PRED_SPECN), sep = "")
test <- data %>%
distinct(Pred_Name, Haul_Join)
View(test)
test <- data %>%
distinct(Pred_common, Haul_Join)
View(wide_data_haul)
test <- data %>%
distinct(uniqueID, Haul_Join)
test <- data %>%
distinct(Year, Haul_Join)
#remove empty stomachs and create unique stomach ID
data <- data %>%
filter(Prey_Name != "Empty") %>%
mutate(uniqueID = paste(HAULJOIN, PRED_NODC, PRED_SPECN), sep = "")
wide_data <- data %>%
mutate(pres_absent = ifelse(PREY_TWT > 0, 1, 0)) %>%
group_by(Pred_common, Haul_Join) %>%
mutate(preysum = sum(pres_absent),
haul_PA = ifelse(preysum > 0, 1, 0))
View(wide_data)
wide_data <- data %>%
mutate(pres_absent = ifelse(PREY_TWT > 0, 1, 0)) %>%
group_by(Pred_common, Haul_Join, Prey_Name) %>%
mutate(preysum = sum(pres_absent),
haul_PA = ifelse(preysum > 0, 1, 0))
wide_data <- data %>%
mutate(pres_absent = ifelse(PREY_TWT > 0, 1, 0)) %>%
group_by(Pred_common, Haul_Join, Prey_Name) %>%
mutate(preysum = sum(pres_absent),
haul_PA = ifelse(preysum > 0, 1, 0)) %>%
distinct(Year, Month, Day, Haul_Join, RLAT, RLONG, GEAR_DEPTH, BOTTOM_DEPTH, START_HOUR,
SURFACE_TEMP, GEAR_TEMP, INPFC_AREA, START_DATE, PRED_LEN, Pred_common, Prey_Name, haul_PA) %>% #This big chunk is to get rid of redundancies
pivot_wider(names_from = Prey_Name, values_from = haul_PA, values_fill = list(haul_PA = 0)) %>%
rename(Walleyepollock = 'Walleye pollock')
wide_data <- data %>%
mutate(pres_absent = ifelse(PREY_TWT > 0, 1, 0)) %>%
group_by(Pred_common, Haul_Join, Prey_Name) %>%
mutate(preysum = sum(pres_absent),
haul_PA = ifelse(preysum > 0, 1, 0)) %>%
distinct(Year, Month, Day, Haul_Join, RLAT, RLONG, GEAR_DEPTH, BOTTOM_DEPTH,
GEAR_TEMP, Pred_common, Prey_Name, haul_PA) %>% #This big chunk is to get rid of redundancies
pivot_wider(names_from = Prey_Name, values_from = haul_PA, values_fill = list(haul_PA = 0)) %>%
rename(Walleyepollock = 'Walleye pollock')
length(unique(data$Haul_Join))
test <- data %>%
distinct(Haul_Join, Pred_common)
?visreg
Model_Output <- function(prey, data) {
Model <- gam(prey ~ Year + s(RLONG, RLAT) + s(GEAR_DEPTH)+ s(GEAR_TEMP, k = 4) + PRED_LEN,
data = data,
family = binomial(link = logit),
method = "GCV.Cp")
summary(Model)
Model_AIC <- dredge(Model, beta = F, evaluate = T, rank = "AIC", trace = F)
print(Model_AIC)
visreg(Model, "Year",type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "Year",
ylab = "Prey Prescence in Pollock Stom")
visreg(Model, "GEAR_DEPTH",type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "Gear_Depth",
ylab = "Prey Prescence in Pollock Stom")
visreg(Model, "GEAR_TEMP",type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "Gear_temp",
ylab = "Prey Prescence in Pollock Stom")
visreg(Model, "Len_bin",type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "Pred_length",
ylab = "Prey Prescence in Pollock Stom")
visreg(Model, "RLONG", type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "RLONG",
ylab = "Prey Prescence in Pollock Stom")
visreg(Model, "RLAT", type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "RLAT",
ylab = "Prey Prescence in Pollock Stom")
return(Model)
}
Model_Output(Euphausiacea, WP)
Model_Output <- function(Euphausiacea, data) {
Model <- gam(Euphausiacea ~ Year + s(RLONG, RLAT) + s(GEAR_DEPTH)+ s(GEAR_TEMP, k = 4) + PRED_LEN,
data = data,
family = binomial(link = logit),
method = "GCV.Cp")
summary(Model)
Model_AIC <- dredge(Model, beta = F, evaluate = T, rank = "AIC", trace = F)
print(Model_AIC)
visreg(Model, "Year",type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "Year",
ylab = "Euphausiacea Prescence in Pollock Stom")
visreg(Model, "GEAR_DEPTH",type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "Gear_Depth",
ylab = "Euphausiacea Prescence in Pollock Stom")
visreg(Model, "GEAR_TEMP",type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "Gear_temp",
ylab = "Euphausiacea Prescence in Pollock Stom")
visreg(Model, "Len_bin",type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "Pred_length",
ylab = "Euphausiacea Prescence in Pollock Stom")
visreg(Model, "RLONG", type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "RLONG",
ylab = "Euphausiacea Prescence in Pollock Stom")
visreg(Model, "RLAT", type = "conditional", scale = "response",
gg = TRUE, line=list(col="black"), xlab = "RLAT",
ylab = "Euphausiacea Prescence in Pollock Stom")
return(Model)
}
Model_Output(Euphausiacea, WP)
library(readr)
library(tidyverse)
library(here)
#Load Data
raw_stomach_contents2021 <- read_csv(here("data/GOA_Raw_StomachContents2021.csv"))
groupings <- read_csv(here("output/groupings.csv"))
sc_groupings <- left_join(raw_stomach_contents2021,groupings,by="Prey_Name") %>%
mutate(uniqueID = paste(HAULJOIN, PRED_NODC, PRED_SPECN,  sep = "_"),
Len_bin = cut(PRED_LEN, breaks = c(0, 20, 40, 60, 280)))
#--------------------------------
#SAMPLE SIZES
#This table shows the number of predator stomachs samples by year, and INPFC area.
#It also shows the avg, min, max, and sd lengths by year and region.
Pred_n_by_Year.INPFC <- sc_groupings %>%
select(Year, uniqueID, Pred_Species, Pred_common, INPFC_AREA, PRED_LEN, PRED_FULL) %>%
distinct(Year, uniqueID, Pred_Species, Pred_common, INPFC_AREA, PRED_LEN, PRED_FULL) %>%
group_by(Year, Pred_common, INPFC_AREA) %>%
mutate(empty_stomachs = sum(PRED_FULL == 1),
full_stomachs = sum(PRED_FULL != 1),
total_stomachs = length(unique(uniqueID)),
length_avg = mean(PRED_LEN),
length_min = min(PRED_LEN),
length_max = max(PRED_LEN),
length_sd = sd(PRED_LEN)) %>%
distinct(Year, Pred_Species, Pred_common, INPFC_AREA, total_stomachs, empty_stomachs, full_stomachs, length_avg, length_min, length_max, length_sd)
View(Pred_n_by_Year.INPFC)
Focal_Pred_n_by_Year.INPFC <- Pred_n_by_Year.INPFC %>%
filter(Pred_common %in% c("Walleye pollock", "Pacific cod", "Pacific halibut", "Arrowtooth flounder"))
View(Focal_Pred_n_by_Year.INPFC)
write.table(Focal_Pred_n_by_Year.INPFC, file = "samplesize.txt", sep = ",", quote = F, row.names = F)
write.table(Focal_Pred_n_by_Year.INPFC, file = here("output/samplesize.txt"), sep = ",", quote = F, row.names = F)
Focal_Pred_n_by_Year.INPFC <- Pred_n_by_Year.INPFC %>%
filter(Pred_common %in% c("Walleye pollock", "Pacific cod", "Pacific halibut", "Arrowtooth flounder")) %>%
select(Year, Pred_common, INPFC_AREA,
total_stomachs, empty_stomachs, full_stomachs,
length_avg, length_min, length_max, length_sd)
write.table(Focal_Pred_n_by_Year.INPFC, file = here("output/samplesize.txt"), sep = ",", quote = F, row.names = F)
#--------------------------------
#SAMPLE SIZES
#This table shows the number of predator stomachs samples by year, and INPFC area.
#It also shows the avg, min, max, and sd lengths by year and region.
Pred_n_by_Year.INPFC <- sc_groupings %>%
select(Year, uniqueID, Pred_Species, Pred_common, INPFC_AREA, PRED_LEN, PRED_FULL) %>%
distinct(Year, uniqueID, Pred_Species, Pred_common, INPFC_AREA, PRED_LEN, PRED_FULL) %>%
group_by(Year, Pred_common, INPFC_AREA) %>%
mutate(empty_stomachs = sum(PRED_FULL == 1),
full_stomachs = sum(PRED_FULL != 1),
total_stomachs = length(unique(uniqueID)),
length_min = min(PRED_LEN),
length_max = max(PRED_LEN),
length_avg = mean(PRED_LEN),
length_sd = sd(PRED_LEN)) %>%
distinct(Year, Pred_Species, Pred_common, INPFC_AREA, total_stomachs, empty_stomachs, full_stomachs, length_avg, length_min, length_max, length_sd)
Focal_Pred_n_by_Year.INPFC <- Pred_n_by_Year.INPFC %>%
filter(Pred_common %in% c("Walleye pollock", "Pacific cod", "Pacific halibut", "Arrowtooth flounder")) %>%
select(Year, Pred_common, INPFC_AREA,
total_stomachs, empty_stomachs, full_stomachs,
length_min, length_max, length_avg, length_sd) %>%
options(digits = 3)
write.table(format(Focal_Pred_n_by_Year.INPFC, digits = 3), file = here("output/samplesize.txt"), sep = ",", quote = F, row.names = F)
write.csv(Focal_Pred_n_by_Year.INPFC, file = here("output/summary_tables/focalsamplesize.csv"), row.names = F)
Focal_Pred_n_by_Year.INPFC <- Pred_n_by_Year.INPFC %>%
filter(Pred_common %in% c("Walleye pollock", "Pacific cod", "Pacific halibut", "Arrowtooth flounder")) %>%
select(Year, Pred_common, INPFC_AREA,
empty_stomachs, full_stomachs, total_stomachs,
length_min, length_max, length_avg, length_sd) %>%
options(digits = 3)
Focal_Pred_n_by_Year.INPFC <- Pred_n_by_Year.INPFC %>%
filter(Pred_common %in% c("Walleye pollock", "Pacific cod", "Pacific halibut", "Arrowtooth flounder")) %>%
select(Year, Pred_common, INPFC_AREA,
empty_stomachs, full_stomachs, total_stomachs,
length_min, length_max, length_avg, length_sd)
write.csv(Focal_Pred_n_by_Year.INPFC, file = here("output/summary_tables/focalsamplesize.csv"), row.names = F)
write.csv(format(Focal_Pred_n_by_Year.INPFC, digits = 3), file = here("output/summary_tables/focalsamplesize.csv"), row.names = F)
write.csv(Focal_Pred_n_by_Year.INPFC, file = here("output/summary_tables/focalsamplesize.csv"), row.names = F)
#This table shows the same data as above, but not broken down by INPFC area just by year
Pred_n_Year <- sc_groupings %>%
select(Year, uniqueID, Pred_Species, Pred_common, PRED_LEN, PRED_FULL) %>%
distinct(Year, uniqueID, Pred_Species, Pred_common, PRED_LEN, PRED_FULL) %>%
group_by(Year, Pred_common) %>%
mutate(empty_stomachs = sum(PRED_FULL == 1),
full_stomachs = sum(PRED_FULL != 1),
total_stomachs = length(unique(uniqueID)),
length_avg = mean(PRED_LEN),
length_min = min(PRED_LEN),
length_max = max(PRED_LEN),
length_sd = sd(PRED_LEN)) %>%
distinct(Year, Pred_Species, Pred_common, empty_stomachs, full_stomachs, total_stomachs, length_avg, length_min, length_max, length_sd)
Pred_n_Year
Focal_Pred_n_Year <- Pred_n_Year %>%
filter(Pred_common %in% c("Walleye pollock", "Pacific cod", "Pacific halibut", "Arrowtooth flounder")) %>%
select(Year, Pred_common,
empty_stomachs, full_stomachs, total_stomachs,
length_min, length_max, length_avg, length_sd)
Focal_Pred_n_Year
Focal_Pred_n_Year <- Pred_n_Year %>%
filter(Pred_common %in% c("Walleye pollock", "Pacific cod", "Pacific halibut", "Arrowtooth flounder")) %>%
select(Year, Pred_common,
empty_stomachs, full_stomachs, total_stomachs,
length_min, length_max, length_avg, length_sd)
write.csv(Focal_Pred_n_Year, file = here("output/summary_tables/focalsamplesizeyear.csv"), row.names = F)
diet_proportions_table <- sc_groupings %>%
filter(PRED_FULL != 1) %>% #removing empty stomachs
group_by(Pred_common, Year, INPFC_AREA, Len_bin) %>%
mutate(TotalWeight = sum(PREY_TWT), #calculating the total stomach weight for each predator
TotalPredN = length(unique(uniqueID))) %>%  #calculating the number of predator stomachs
group_by(Pred_common, Prey_Name_Clean, Year, INPFC_AREA, Len_bin) %>%
mutate(NStomachs = length(unique(uniqueID)),
Percent_Occur = NStomachs/TotalPredN*100,
PreyWeight = sum(PREY_TWT),
Percent_Weight = (PreyWeight/TotalWeight)*100) %>%
select(Year, INPFC_AREA, Pred_Species, Pred_common, Len_bin, Prey_Name_Clean,
TotalPredN, NStomachs, Percent_Occur,
TotalWeight, PreyWeight, Percent_Weight)
View(diet_proportions_table)
View(diet_proportions_table)
general_diets_focal <- sc_groupings %>%
filter(PRED_FULL != 1) %>% #removing empty stomachs
filter(Pred_common %in% c("Walleye pollock", "Pacific cod", "Pacific halibut", "Arrowtooth flounder")) %>%
group_by(Pred_common, Year) %>%
mutate(TotalWeight = sum(PREY_TWT), #calculating the total stomach weight for each predator
TotalPredN = length(unique(uniqueID))) %>%  #calculating the number of predator stomachs
group_by(Pred_common, Prey_Name_Clean, Year) %>%
mutate(NStomachs = length(unique(uniqueID)),
Percent_Occur = NStomachs/TotalPredN*100,
PreyWeight = sum(PREY_TWT),
Percent_Weight = (PreyWeight/TotalWeight)*100) %>%
select(Year, Pred_common, Prey_Name_Clean,
TotalPredN, NStomachs, Percent_Occur,
TotalWeight, PreyWeight, Percent_Weight)
general_diets_focal
View(general_diets_focal)
general_diets_focal <- sc_groupings %>%
filter(PRED_FULL != 1) %>% #removing empty stomachs
filter(Pred_common %in% c("Walleye pollock", "Pacific cod", "Pacific halibut", "Arrowtooth flounder")) %>%
group_by(Pred_common) %>%
mutate(TotalWeight = sum(PREY_TWT), #calculating the total stomach weight for each predator
TotalPredN = length(unique(uniqueID))) %>%  #calculating the number of predator stomachs
group_by(Pred_common, Prey_Name_Clean) %>%
mutate(NStomachs = length(unique(uniqueID)),
Percent_Occur = NStomachs/TotalPredN*100,
PreyWeight = sum(PREY_TWT),
Percent_Weight = (PreyWeight/TotalWeight)*100) %>%
select(Pred_common, Prey_Name_Clean,
TotalPredN, NStomachs, Percent_Occur,
TotalWeight, PreyWeight, Percent_Weight)
general_diets_focal <- sc_groupings %>%
filter(PRED_FULL != 1) %>% #removing empty stomachs
filter(Pred_common %in% c("Walleye pollock", "Pacific cod", "Pacific halibut", "Arrowtooth flounder")) %>%
group_by(Pred_common) %>%
mutate(TotalWeight = sum(PREY_TWT), #calculating the total stomach weight for each predator
TotalPredN = length(unique(uniqueID))) %>%  #calculating the number of predator stomachs
group_by(Pred_common, Prey_Name_Clean) %>%
mutate(NStomachs = length(unique(uniqueID)),
Percent_Occur = NStomachs/TotalPredN*100,
PreyWeight = sum(PREY_TWT),
Percent_Weight = (PreyWeight/TotalWeight)*100) %>%
distinct(Pred_common, Prey_Name_Clean,
TotalPredN, NStomachs, Percent_Occur,
TotalWeight, PreyWeight, Percent_Weight)
test <- general_diets_focal %>%
group_by(Pred_common) %>%
arrange(desc(Percent_Weight)) %>%
slice(1:25)
View(test)
general_diets_focal <- sc_groupings %>%
filter(PRED_FULL != 1) %>% #removing empty stomachs
filter(Pred_common %in% c("Walleye pollock", "Pacific cod", "Pacific halibut", "Arrowtooth flounder")) %>%
group_by(Pred_common) %>%
mutate(TotalWeight = sum(PREY_TWT), #calculating the total stomach weight for each predator
TotalPredN = length(unique(uniqueID))) %>%  #calculating the number of predator stomachs
group_by(Pred_common, Prey_Name_Clean) %>%
mutate(NStomachs = length(unique(uniqueID)),
Percent_Occur = NStomachs/TotalPredN*100,
PreyWeight = sum(PREY_TWT),
Percent_Weight = (PreyWeight/TotalWeight)*100) %>%
distinct(Pred_common, Prey_Name_Clean, NStomachs, Percent_Occur, Percent_Weight)
test <- general_diets_focal %>%
group_by(Pred_common) %>%
arrange(desc(Percent_Weight)) %>%
slice(1:25)
#Select top 50 prey items for each predator
general_diets_focal <- general_diets_focal %>%
group_by(Pred_common) %>%
arrange(desc(Percent_Weight)) %>%
slice(1:25)
write.csv(general_diets_focal, file = here("output/summary_tables/general_diets_focal.csv"), row.names = F)
#Select top 50 prey items for each predator
general_diets_focal <- general_diets_focal %>%
group_by(Pred_common) %>%
mutate(checkPW = sum(Percent_Weight))
general_diets_focal <- general_diets_focal %>%
group_by(Pred_common) %>%
mutate(checkPW = sum(Percent_Weight))
general_diets_focal <- sc_groupings %>%
filter(PRED_FULL != 1) %>% #removing empty stomachs
filter(Pred_common %in% c("Walleye pollock", "Pacific cod", "Pacific halibut", "Arrowtooth flounder")) %>%
group_by(Pred_common) %>%
mutate(TotalWeight = sum(PREY_TWT), #calculating the total stomach weight for each predator
TotalPredN = length(unique(uniqueID))) %>%  #calculating the number of predator stomachs
group_by(Pred_common, Prey_Name_Clean) %>%
mutate(NStomachs = length(unique(uniqueID)),
Percent_Occur = NStomachs/TotalPredN*100,
PreyWeight = sum(PREY_TWT),
Percent_Weight = (PreyWeight/TotalWeight)*100) %>%
distinct(Pred_common, Prey_Name_Clean, NStomachs, Percent_Occur, Percent_Weight)
#Select top 50 prey items for each predator
general_diets_focal <- general_diets_focal %>%
group_by(Pred_common) %>%
mutate(checkPW = sum(Percent_Weight))

geom_smooth(formula = lm(log(y = LingWt_g) ~ log(x = LingLength_cm)))
#I wanted to start by looking at length to weight of Lingcod because there is a very clear power growth curve
#Plot length to weight
final.data.2 %>%
ggplot(aes(x=LingLength_cm, y = LingWt_g))+
geom_point()+
theme_minimal()+
geom_smooth(formula = lm(log(LingWt_g) ~ log(LingLength_cm)))
#I wanted to start by looking at length to weight of Lingcod because there is a very clear power growth curve
#Plot length to weight
final.data.2 %>%
ggplot(aes(x=LingLength_cm, y = LingWt_g))+
geom_point()+
theme_minimal()+
geom_smooth(formula = lm(log(y) ~ log(x)))
#I wanted to start by looking at length to weight of Lingcod because there is a very clear power growth curve
#Plot length to weight
final.data.2 %>%
ggplot(aes(x=LingLength_cm, y = LingWt_g))+
geom_point()+
theme_minimal()+
geom_smooth(method = "lm")
#I wanted to start by looking at length to weight of Lingcod because there is a very clear power growth curve
#Plot length to weight
final.data.2 %>%
ggplot(aes(x=LingLength_cm, y = LingWt_g))+
geom_point()+
theme_minimal()+
geom_smooth(method = "glm")
#I wanted to start by looking at length to weight of Lingcod because there is a very clear power growth curve
#Plot length to weight
final.data.2 %>%
ggplot(aes(x=LingLength_cm, y = LingWt_g))+
geom_point()+
theme_minimal()+
geom_smooth(method = "gam")
#I wanted to start by looking at length to weight of Lingcod because there is a very clear power growth curve
#Plot length to weight
final.data.2 %>%
ggplot(aes(x=LingLength_cm, y = LingWt_g))+
geom_point()+
theme_minimal()+
geom_smooth(method = "loess")
#I wanted to start by looking at length to weight of Lingcod because there is a very clear power growth curve
#Plot length to weight
final.data.2 %>%
ggplot(aes(x=LingLength_cm, y = LingWt_g))+
geom_point()+
theme_minimal()+
stat_smooth(method = "loess")
geom
#I wanted to start by looking at length to weight of Lingcod because there is a very clear power growth curve
#Plot length to weight
final.data.2 %>%
ggplot(aes(x=LingLength_cm, y = LingWt_g))+
geom_point()+
theme_minimal()+
geom_smooth(method = "loess")
#Plot pred weight to prey weight
final.data.2 %>%
ggplot(aes(x=LingWt_g, y = PreyWt_g))+
geom_point()+
theme_minimal()
#Plot pred length to prey number
final.data.2 %>%
ggplot(aes(x=LingLength_cm, y = PreyNum))+
geom_point()+
theme_minimal()
#Percent by Weight %W
#(sum weight of prey type i) / (total weight of all prey) x 100
Weight <-
as.data.frame(summarise(
group_by(final.data.2, PreyTaxa),
TotalWt = sum(PreyWt_g)
))
View(Weight)
Weight$PW <- Weight$TotalWt/sum(Weight$TotalWt)
#next d
Weight$PW <- (Weight$TotalWt/sum(Weight$TotalWt))*100
#next find the total weight of all prey
sum(Weight$TotalWt)
#last calculate percent weight in new column
Weight$PW <- (Weight$TotalWt/10396.51)*100
Weight1 <- Weight[!(Weight$PreyTaxa=="Empty"),]
View(Weight1)
###Percent by Weight %W
#(sum weight of prey type i) / (total weight of all prey) x 100
#First find the sum weight of each prey type
Weight <-
as.data.frame(summarise(
group_by(final.data, PreyTaxa),
TotalWt = sum(PreyWt_g)
))
#next find the total weight of all prey
sum(Weight$TotalWt) #Answer: 10396.51
#last calculate percent weight in new column
Weight$PW <- (Weight$TotalWt/10396.51)*100
###Percent by number %N
#(sum of number of individuals of prey type i) / (total number of all prey) * 100
#We know from the instructions that there were 1764 prey items sampled
Number <-
as.data.frame(summarise(
group_by(final.data, PreyTaxa),
N = sum(PreyNum)
))
View(Number)
TotalN=sum(PreyNum)
#Next find the total number of prey
sum(Number$N)
#calculate percent weight in new column
Number$N <- (Number$N/1443)*100
###Percent by number %N
#(sum of number of individuals of prey type i) / (total number of all prey) * 100
#We know from the instructions that there were 1764 prey items sampled
#First find the sum of number of individuals of each prey type
Number <-
as.data.frame(summarise(
group_by(final.data, PreyTaxa),
N = sum(PreyNum)
))
#calculate percent weight in new column
Number$PN <- (Number$N/1443)*100
Freq <- summarise(group_by(data, PreyTaxa), NStomachs=sum(unique(LingID)*0+1))
View(Freq)
Occur <-
as.data.frame(summarise(
group_by(final.data, PreyTaxa),
Occ = sum(unique(LingID))
))
View(Occur)
Occur <-
as.data.frame(summarise(
group_by(final.data, PreyTaxa),
Occ = sum(unique(LingID)*0+1)
))
#next calculate total number of lincod sampled
sum(unique(LingID)*0+1)
#next calculate total number of lincod sampled
sum(unique(final.data$LingID)*0+1)
#next calculate total number of lincod sampled
Occur$PO <- Occur$Occ/TotalPredN
#next calculate total number of lingcod sampled
Occ
#next calculate total number of lingcod sampled
sum(unique(LingID)*0+1
#next calculate total number of lingcod sampled
sum(unique(data.final$LingID)*0+1
#next calculate total number of lingcod sampled
sum(unique(LingID)*0+1)
#next calculate total number of lingcod sampled
sum(unique(final.data$LingID)*0+1)
Occur$PO <- (Occur$Occ/950)*100
Occur <- Occur[!(Occur$PreyTaxa=="Empty"),]
Occur$PO <- (Occur$Occ/950)*100
#First calculate number of lingcod with more than one prey
Occur <-
as.data.frame(summarise(
group_by(final.data, PreyTaxa),
Occ = sum(unique(LingID)*0+1)
))
#calculate percent occurance
Occur$PO <- (Occur$Occ/950)*100
#merge
DietSummary <- merge(Weight,Number) %>%
merge(Occur)
View(DietSummary)
#plotting proportion by weight vs freq of occurance
ggplot(DietSummary, aes(x=PO, y=PW)) +
geom_point(size = 3, alpha = 0.5)
#plotting proportion by weight vs freq of occurance
ggplot(DietSummary, aes(x=PO, y=PW)) +
geom_point(size = 3, alpha = 0.5)+
theme_minimal
#plotting proportion by weight vs freq of occurance
ggplot(DietSummary, aes(x=PO, y=PW)) +
geom_point(size = 3, alpha = 0.5)+
theme_minimal()
# Calculate diet by season
dat <- final.data %>%
group_by(Season, PreyTaxa) %>%
summarize(sum(PreyWt_g))
colnames(dat)<-c("Season","PreyTaxa","PreyWt")
seasonal <- dat %>% spread(PreyTaxa,PreyWt)
# Calculate cumulative prey curves (rarefaction curves) and set up the data for plotting
dat.sub <- final.data[,c(1,4:5)]
dat.sub <- distinct(dat.sub)
colnames(dat.sub) <- c("LingID","Season","PreyTaxa")
dat.sub$NPred <- 1
dat.long <- dat.sub %>% spread(PreyTaxa,NPred); dat.long[is.na(dat.long)]<-0
dat.winter<-dat.long[dat.long$Season=="Winter",-c(1:2,9)]
dat.spring<-dat.long[dat.long$Season=="Spring",-c(1:2,9)]
dat.summer<-dat.long[dat.long$Season=="Summer",-c(1:2,9)]
dat.fall<-dat.long[dat.long$Season=="Fall",-c(1:2,9)]
cumu.winter <- specaccum(dat.winter)
cumu.winter <- data.frame(Stomachs=cumu.winter$sites, Richness=cumu.winter$richness, SD=cumu.winter$sd) %>%
mutate(Season = "Winter") #Convert object of class specaccum to data frame for plotting in ggplot and add column with season
cumu.spring <- specaccum(dat.spring)
cumu.spring <- data.frame(Stomachs=cumu.spring$sites, Richness=cumu.spring$richness, SD=cumu.spring$sd) %>%
mutate(Season = "Spring")
cumu.summer <- specaccum(dat.summer)
cumu.summer <- data.frame(Stomachs=cumu.summer$sites, Richness=cumu.summer$richness, SD=cumu.summer$sd) %>%
mutate(Season = "Summer")
cumu.fall <- specaccum(dat.fall)
cumu.fall <- data.frame(Stomachs=cumu.fall$sites, Richness=cumu.fall$richness, SD=cumu.fall$sd) %>%
mutate(Season = "fall")
cumu <- bind_rows(cumu.winter,cumu.spring,cumu.summer,cumu.fall) #Combine all seasons into one data frame
# Plot cumulative prey curves (rarefaction curves)
ggplot(cumu, aes(x=Stomachs, y=Richness, colour=Season)) +
geom_line(data=cumu) +
geom_ribbon(data=cumu,aes(ymin=Richness-SD,ymax=Richness+SD, fill=Season),alpha=0.1) +
theme_bw(base_size = 14)
# Stacked bar plots (proportion by weight)
proportion <- data %>%
group_by(Season,PreyTaxa) %>%
summarize(sum(PreyWt_g))
colnames(proportion)<-c("Season","PreyTaxa","Sum")
proportion <- proportion %>%
mutate(Prop = Sum / sum(Sum))
proportion <- proportion[!proportion$PreyTaxa=="Empty",]
colorlist<-c('#e6194b', '#f58231', '#ffe119', '#bcf60c', '#3cb44b', '#46f0f0',
'#4363d8', '#911eb4', '#f032e6', '#800000', '#9A6324',
'#ffd8b1', '#808000', '#fffac8', '#000075', '#008080',
'#aaffc3', '#e6beff', '#a9a9a9') #Extra colors: '#fabebe'
ggplot(proportion, aes(x = Season, Prop, fill = PreyTaxa)) +
geom_bar(stat = "identity", color = "black") +
scale_fill_manual(values = colorlist) +
ylab("Proportion") + xlab("Season") +
theme_bw(base_size = 14)
colorlist<-c('#e6194b', '#f58231', '#ffe119', '#bcf60c', '#3cb44b', '#46f0f0',
'#4363d8', '#911eb4', '#f032e6', '#800000', '#9A6324',
'#ffd8b1', '#808000', '#fffac8', '#000075', '#008080',
'#aaffc3', '#e6beff', '#a9a9a9', '#fabebe') #Extra colors: '#fabebe'
ggplot(proportion, aes(x = Season, Prop, fill = PreyTaxa)) +
geom_bar(stat = "identity", color = "black") +
scale_fill_manual(values = colorlist) +
ylab("Proportion") + xlab("Season") +
theme_bw(base_size = 14)
# Plot cumulative prey curves (rarefaction curves)
ggplot(cumu, aes(x=Stomachs, y=Richness, colour=Season)) +
geom_line(data=cumu) +
geom_ribbon(data=cumu,aes(ymin=Richness-SD,ymax=Richness+SD, fill=Season),alpha=0.1) +
theme_bw(base_size = 14)
View(cumu.fall)
rm(list=ls())
#This is my first look at the food habits data
#edit
#load some libraries
library(readr)
library(tidyverse)
#load in the raw data
raw_prey_length <- read_csv("data/1_Gulf Of Alaska_Raw_PreyLength.csv")
raw_stomach_contents <- read_csv("data/1_Gulf Of Alaska_Raw_StomachContents.csv")
#what type of dataframe is this?
class(raw_prey_length)
class(raw_stomach_contents)
View(raw_prey_length)
View(raw_stomach_contents)
#I want to play around with the data a bit, so how about I subset it to only include year 2019
raw_prey_length %>%
filter(Year == 2019) ->
length.sub
raw_stomach_contents %>%
filter(Year == 2019) ->
stomach.sub
left_join(length.sub, stomach.sub) ->
data
View(data)
left_join(stomach.sub, length.sub) ->
data
#load in the raw data
raw_prey_length <- read_csv("data/GOA_Raw_PreyLength.csv")
#This is my first look at the food habits data
#edit
#load some libraries
library(readr)
library(tidyverse)
#load in the raw data
raw_prey_length <- read_csv("data/GOA_Raw_PreyLength.csv")
raw_stomach_contents <- read_csv("data/GOA_Raw_StomachContents.csv")
View(raw_prey_length)
View(raw_stomach_contents)
#Load Libraries
library(here)
library(tidyverse)
library(plotly)
library(RColorBrewer)
library(vegan)
#input datasets
data.raw <- read_csv(here("data", "DietTutorialRaw.csv"))
data.clean <- read_csv(here("data", "DietTutorialClean.csv"))
loc <- read_csv(here("data", "LocationTutorial.csv"))
#join datasets
data <-left_join(data.raw, loc)
#converting variables to correct type
data$LingID <- as.integer(data$LingID)
data$PreyOccur <- as.integer(data$PreyOccur)
#sub out the errors
data$PreyTaxa <- gsub("Teleostei unid", "Teleostei NEI", data$PreyTaxa)
data$PreyTaxa <- gsub("Zoarcoidei", "Suborder Zoarcoidei", data$PreyTaxa)
#Fixing: there is a lingcod that has a length of 3cm which I think is an error. I'm going to change it from 3.3 to 33
data$LingLength_cm[data$LingLength_cm == 3.3] <- 33
#Fixing: I found a couple of lingcod that have no weight measurements. I'm going to replace 0 with NA values.
data$LingWt_g[data$LingWt_g == 0] <- NA
#Fixing: I'm replacing the 1 value with a 0
data %>%
filter(LingID ==1530) %>%
mutate(PreyOccur = recode(PreyOccur, '1' = 0)) ->
data3
data %>%
filter(LingID ==1139) %>%
mutate(PreyOccur = recode(PreyOccur, '1' = 0)) ->
data2
#Fixing: I'm changing the prey code from 2 to 1
data %>%
filter(LingID ==578) %>%
mutate(PreyCode = recode(PreyCode, '2' = 1)) ->
data1
View(data1)
#Fixing: I'm changing the prey code from 2 to 1
data %>%
filter(LingID ==578) %>%
mutate(PreyCode = recode(PreyCode, '2' = 1)) ->
data
View(data)
#input datasets
data.raw <- read_csv(here("data", "DietTutorialRaw.csv"))
data.clean <- read_csv(here("data", "DietTutorialClean.csv"))
loc <- read_csv(here("data", "LocationTutorial.csv"))
#join datasets
data <-left_join(data.raw, loc)
#converting variables to correct type
data$LingID <- as.integer(data$LingID)
data$PreyOccur <- as.integer(data$PreyOccur)
#sub out the errors
data$PreyTaxa <- gsub("Teleostei unid", "Teleostei NEI", data$PreyTaxa)
data$PreyTaxa <- gsub("Zoarcoidei", "Suborder Zoarcoidei", data$PreyTaxa)
#Fixing: there is a lingcod that has a length of 3cm which I think is an error. I'm going to change it from 3.3 to 33
data$LingLength_cm[data$LingLength_cm == 3.3] <- 33
#Fixing: I found a couple of lingcod that have no weight measurements. I'm going to replace 0 with NA values.
data$LingWt_g[data$LingWt_g == 0] <- NA
data %>%
mutate(PreyCode == ifelse(LingID == 578, 1, PreyCode))->
DataNew
View(DataNew)
data %>%
mutate(PreyCode = ifelse(LingID == 578, 1, PreyCode))->
DataNew
View(DataNew)
library(vegan)
#what type of dataframe is this?
class(raw_prey_length) # "spec_tbl_df"
#This is my first look at the food habits data
#edit
#load some libraries
library(readr)
library(tidyverse)
#load in the raw data
raw_prey_length <- read_csv("data/GOA_Raw_PreyLength.csv")
raw_stomach_contents <- read_csv("data/GOA_Raw_StomachContents.csv")
#what type of dataframe is this?
class(raw_prey_length) # "spec_tbl_df"
class(raw_stomach_contents) # "spec_tbl_df"
#don't know if I need the race data but I found it...
RaceData2015_2019 <- read_csv("data/RaceDatagoa2015_2019.csv")
#I want to convert it into a spatial dataframe
stomach <- st_as_sf(raw_stomach_contents, coords = c("Rlong", "Rlat"), crs = 3467)
library(sf)
#I want to convert it into a spatial dataframe
stomach <- st_as_sf(raw_stomach_contents, coords = c("Rlong", "Rlat"), crs = 3467)
class(stomach)
ggplot(data = stomach) +
geom_sf()
View(stomach)
ggplot(data = stomach, aes(x = Year, y = Surface_temp)) +
geom_boxplot()
ggplot(data = stomach, aes(x = Year, y = Surface_temp)) +
geom_point()
surfacetemp <- ggplot(data = stomach, aes(x = Year, y = Surface_temp)) +
geom_point() +
theme_classic()
library(here)
ggsave("surfacetemp.jpg", plot = surfacetemp, device = "jpg", path = "output")
#Let's play around with looking at a specific predator
PacificHalibut <- stomach %>%
filter(Pred_nodc == 8857041901)
View(PacificHalibut)
head(stomach)
ggplot(data = PacificHalibut, aes(x = Pred_stomwt, y = Pred_len)) +
geom_point
ggplot(data = PacificHalibut, aes(x = Pred_stomwt, y = Pred_len)) +
geom_point()
ggplot(data = PacificHalibut, aes(y = Pred_stomwt, x = Pred_len)) +
geom_point()
ggplot(data = PacificHalibut, aes(y = Pred_stomwt, x = Pred_len)) +
geom_point() +
theme_classic()
ggplot(data = PacificHalibut, aes(y = Pred_stomwt, x = Pred_len)) +
geom_point() +
theme_classic() +
labs(title = "P. Halibut")
phabstom <- ggplot(data = PacificHalibut, aes(y = Pred_stomwt, x = Pred_len)) +
geom_point() +
theme_classic() +
labs(title = "P. Halibut")
ggsave("phab_stom_len.jpg", plot = phabstom, device = "jpg", path = "output")
ggplot(data = PacificHalibut, aes(x = Pred_len)) +
geom_histogram()
ggplot(data = PacificHalibut, aes(x = Pred_len)) +
geom_histogram() +
theme_classic() +
labs(title = "P. Halibut")
phabhist <- ggplot(data = PacificHalibut, aes(x = Pred_len)) +
geom_histogram() +
theme_classic() +
labs(title = "P. Halibut")
ggsave("phab_len_hist.jpg", plot = phabhist, device = "jpg", path = "output")
phabhist <- ggplot(data = PacificHalibut, aes(x = Pred_len)) +
geom_histogram(bins = 100) +
theme_classic() +
labs(title = "P. Halibut")
phabhist
phabhist <- ggplot(data = PacificHalibut, aes(x = Pred_len)) +
geom_histogram(bins = 200) +
theme_classic() +
labs(title = "P. Halibut")
phabhist
View(RaceData2015_2019)
unique(stomach$Prey_Name)
sum(unique(stomach$Prey_Name))
length(unique(stomach$Prey_Name))
length(unique(PacificHalibut$Prey_Name))
#QC Checks:
#check that Pred_Full matches the Pred_stomwt
stomach %>%
filter(Pred_full == 1) %>%
ggplot(aes(x = Pred_stomwt)) +
geom_histogram()
#QC Checks:
#check that Pred_Full matches the Pred_stomwt
stomach %>%
filter(Pred_full == 1) %>%
ggplot(aes(x = Pred_stomwt)) +
geom_point()
#QC Checks:
#check that Pred_Full matches the Pred_stomwt
stomach %>%
filter(Pred_full == 1) %>%
ggplot(aes(x = Pred_stomwt, y = Pred_len)) +
geom_point()
#looks clean lets try the other way
stomach %>%
filter(Pred_stomwt == 0) %>%
ggplot(aes(x = Pred_full, y = Pred_len)) +
geom_point()
#CHECK THIS, seems like an error? if the stomach weight is 0 the pred full values should all be 1
stomach %>%
filter(Pred_stomwt == 0) %>%
ggplot(aes(x = Prey_twt, y = Pred_len)) +
geom_point()
stomach %>%
filter(Pred_stomwt == 0) %>%
ggplot(aes(x = Prey_dig, y = Pred_len)) +
geom_point()
stomach %>%
filter(Pred_stomwt == 0) %>%
ggplot(aes(x = Pred_dig, y = Pred_len)) +
geom_point()
#This is my first look at the food habits data
#edit
#load some libraries
library(readr)
library(tidyverse)
library(sf)
library(here)
#load in the raw data
raw_prey_length <- read_csv("data/GOA_Raw_PreyLength.csv")
raw_stomach_contents <- read_csv("data/GOA_Raw_StomachContents.csv")
#what type of dataframe is this?
class(raw_prey_length) # "spec_tbl_df"
class(raw_stomach_contents) # "spec_tbl_df"
#------------------- Halibut! ----------------
#Let's play around with looking at a specific predator, I'm using the nodc code for P Halibut
PacificHalibut <- stomach %>%
filter(Pred_nodc == 8857041901)
#I want to convert it into a spatial dataframe
stomach <- st_as_sf(raw_stomach_contents, coords = c("Rlong", "Rlat"), crs = 3467)
#------------------- Halibut! ----------------
#Let's play around with looking at a specific predator, I'm using the nodc code for P Halibut
PacificHalibut <- stomach %>%
filter(Pred_nodc == 8857041901)
length(unique(stomach$Prey_Name)) #I got 90, sooo there are two missing groups?
length(unique(PacificHalibut$Prey_Name)) #82 for halibut not very picky eaters
#-------------------QC Checks ------------------
#check that Pred_Full matches the Pred_stomwt
stomach %>%
filter(Pred_full == 1) %>%
ggplot(aes(x = Pred_stomwt, y = Pred_len)) +
geom_point()
stomach %>%
filter(Pred_stomwt == 0) %>%
ggplot(aes(x = Pred_full, y = Pred_len)) +
geom_point()
#CHECK THIS, seems like an error? if the stomach weight is 0 the pred full values should all be 1
stomach %>%
filter(Pred_stomwt == 0) %>%
ggplot(aes(x = Prey_twt, y = Pred_len)) +
geom_point()
#HMMM this also seems wrong for the same reasons?
stomach %>%
filter(Pred_stomwt == 0) %>%
ggplot(aes(x = Pred_dig, y = Pred_len)) +
geom_point()
